#!/usr/bin/env bash

# TODO check that you have aws credentials
# TODO check that SSM_PREFIX tag

while read LINE
do
  eval $LINE
done < <($(dirname $0)/aws-env-vars)

GHOST_DIR=${GHOST_DIR-/var/www/ghost}
PROJ_DIR=${PROJ_DIR-$(cd $(dirname ${0}); cd ..; pwd)}
BACKUP_FILENAME=${BACKUP_FILENAME-ghost-backup.tbz2}
BACKUP_DIR=${BACKUP_DIR-${PROJ_DIR}/backups}
WEB_DIR=${WEB_DIR-${PROJ_DIR}/static_website}

echo "
GS_BIN=${PROJ_DIR}/bin
CLOUDFRONT_ID=${CLOUDFRONT_ID}
CMS_HOSTNAME=${CMS_HOSTNAME}
WEB_HOSTNAME=${WEB_HOSTNAME}
CMS_BUCKET=${CMS_BUCKET}
WEB_BUCKET=${WEB_BUCKET}
CMS_BUCKET_PREFIX=s3://${CMS_BUCKET}
WEB_BUCKET_PREFIX=s3://${WEB_BUCKET}
INACTIVE_SECONDS=${INACTIVE_SECONDS-7200}
GHOST_DIR=$GHOST_DIR
BACKUP_DIR=$BACKUP_DIR
WEB_DIR=$WEB_DIR
TEMPLATE_DIR=${PROJ_DIR}/templates
BACKUP_FILENAME=${BACKUP_FILENAME}
LOG_DIR=${GHOST_DIR}/content/logs
BACKUP_FILE=${BACKUP_DIR}/${BACKUP_FILENAME}
ZONE_ID=${ZONE_ID}
GHOST_API_KEY=\"${GHOST_API_KEY}\"
FRIENDLY_CAPTCHA_APIKEY=\"${FRIENDLY_CAPTCHA_APIKEY}\"
FRIENDLY_CAPTCHA_SITEKEY=\"${FRIENDLY_CAPTCHA_SITEKEY}\"
DATABASE_CLUSTER=${DATABASE_HOST%%.*}
DATABASE_HOST=${DATABASE_HOST}
DATABASE_USER=${DATABASE_USER}
DATABASE_PASSWORD=${DATABASE_PASSWORD}
DATABASE_NAME=${DATABASE_NAME}
SMTP_USER=${SMTP_USER}
SMTP_PASSWORD=${SMTP_PASSWORD}

" > ${PROJ_DIR}/.env
